using System;
using System.Collections.Generic;
using FullSerializer;
using UnityEngine;

// Token: 0x020002AB RID: 683
[fsObject(MemberSerialization = fsMemberSerialization.OptOut)]
public partial class TeamManager : GenericManager<Team>
{
	// Token: 0x06001403 RID: 5123
	public void TeamRebrand()
	{
		float num = 0f;
		float num2 = 0f;
		float num3 = 0f;
		if (Game.instance.time.now.Month > 5)
		{
			float t = MathsUtility.Clamp((Game.instance.player.stats.loyalty + Game.instance.player.stats.loyalty + Game.instance.player.stats.raceManagement - 15f + (float)RandomUtility.GetRandom(0, 10)) / 55f, 0f, 1f);
			float t2 = MathsUtility.Clamp((Game.instance.player.stats.loyalty + Game.instance.player.stats.loyalty + Game.instance.player.stats.raceManagement - 15f + (float)RandomUtility.GetRandom(0, 10)) / 15f, 0f, 1f);
			float t3 = MathsUtility.Clamp((Game.instance.player.stats.loyalty + Game.instance.player.stats.loyalty + Game.instance.player.stats.raceManagement - 15f + (float)RandomUtility.GetRandom(0, 10)) / 35f, 0f, 1f);
			num = (float)Mathf.RoundToInt(Mathf.Lerp(29f, 0f, t));
			num2 = (float)Mathf.RoundToInt(Mathf.Lerp(49f, 30f, t2));
			num3 = (float)Mathf.RoundToInt(Mathf.Lerp(61f, 50f, t3));
		}
		List<Team> teamList = Game.instance.championshipManager.GetChampionshipByID(0).standings.GetTeamList();
		EntityManager arg_1CC_0 = Game.instance.entityManager;
		List<DatabaseEntry> teamData = App.instance.database.teamData;
		int num4 = 0;
		if (teamData.Count > 72)
		{
			num4 = 62 - teamData.Count + teamData[0].GetIntValue("Opinions - Manager");
		}
		if (teamData.Count >= 72)
		{
			for (int i = 0; i < teamData.Count + num4; i++)
			{
				if (base.count <= 200)
				{
					base.AddEntity(base.GetEntity(teamData.Count + num4 - 1));
				}
				base.GetEntity(i).liveryID = RandomUtility.GetRandomInc(0, 74);
				float random = RandomUtility.GetRandom01();
				int random2 = RandomUtility.GetRandom(0, teamData.Count);
				int num5 = i;
				bool flag = false;
				bool flag2 = false;
				bool flag3 = false;
				for (int j = 0; j <= 2; j++)
				{
					teamList = Game.instance.championshipManager.GetChampionshipByID(j).standings.GetTeamList();
					for (int k = 0; k < teamList.Count; k++)
					{
						if (base.GetEntity(i).teamID == teamList[k].teamID)
						{
							flag = true;
						}
					}
				}
				if (flag)
				{
					for (int l = 0; l <= 2; l++)
					{
						teamList = Game.instance.championshipManager.GetChampionshipByID(l).standings.GetTeamList();
						for (int m = 0; m < teamList.Count; m++)
						{
							if (random2 == teamList[m].teamID)
							{
								num5 = i - 1;
							}
						}
					}
				}
				for (int n = 3; n <= 4; n++)
				{
					teamList = Game.instance.championshipManager.GetChampionshipByID(n).standings.GetTeamList();
					for (int num6 = 0; num6 < teamList.Count; num6++)
					{
						if (base.GetEntity(i).teamID == teamList[num6].teamID)
						{
							flag2 = true;
						}
					}
				}
				if (flag2)
				{
					for (int num7 = 3; num7 <= 4; num7++)
					{
						teamList = Game.instance.championshipManager.GetChampionshipByID(num7).standings.GetTeamList();
						for (int num8 = 0; num8 < teamList.Count; num8++)
						{
							if (random2 == teamList[num8].teamID)
							{
								num5 = i - 1;
							}
						}
					}
				}
				for (int num9 = 5; num9 <= 6; num9++)
				{
					teamList = Game.instance.championshipManager.GetChampionshipByID(num9).standings.GetTeamList();
					for (int num10 = 0; num10 < teamList.Count; num10++)
					{
						if (base.GetEntity(i).teamID == teamList[num10].teamID)
						{
							flag3 = true;
						}
					}
				}
				if (flag3)
				{
					for (int num11 = 5; num11 <= 6; num11++)
					{
						teamList = Game.instance.championshipManager.GetChampionshipByID(num11).standings.GetTeamList();
						for (int num12 = 0; num12 < teamList.Count; num12++)
						{
							if (random2 == teamList[num12].teamID)
							{
								num5 = i - 1;
							}
						}
					}
				}
				if (base.GetEntity(i).financeController.finance.currentBudget < -5000000L && !base.GetEntity(i).isCreatedByPlayer && random < 0.2f && num5 == i)
				{
					base.GetEntity(i + teamData.Count + num4).name = base.GetEntity(i).name;
					base.GetEntity(i).name = teamData[random2].GetStringValue("Name");
					base.GetEntity(i).locationID = teamData[random2].GetStringValue("Location ID");
					base.GetEntity(i).colorID = teamData[random2].GetIntValue("Color");
					base.GetEntity(i).nationality = Nationality.GetNationalityByName(teamData[random2].GetStringValue("Location"));
					base.GetEntity(i).teamID = random2;
					base.GetEntity(i).aggression = teamData[random2].GetFloatValue("Aggression");
					base.GetEntity(i).fanBase = teamData[random2].GetFloatValue("Fan Base");
					base.GetEntity(i).votingCharacteristics = this.GetCharacteristics(teamData[random2].GetStringValue("Political Attributes"));
					if (RandomUtility.GetRandom01() < 0.8f)
					{
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(0), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(1), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(2), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
					}
					if (RandomUtility.GetRandom01() < 4f)
					{
						base.GetEntity(i).financeController.finance.currentBudget = (long)(teamData[random2].GetFloatValue("Budget") * 1000000f);
					}
					if (RandomUtility.GetRandom01() < 0.8f)
					{
						base.GetEntity(i).headquarters.ResetHeadquarters();
					}
					if (RandomUtility.GetRandom01() < 0.8f)
					{
						base.GetEntity(i).sponsorController.ClearAllSponsors();
						base.GetEntity(i).sponsorController.ClearAllSponsorOffers();
					}
					if (RandomUtility.GetRandom01() < 1f)
					{
						base.GetEntity(i).carManager.AdaptPartsForNewSeason1(0.7f, 1f);
					}
					StringVariableParser.promotedTeam = base.GetEntity(i + teamData.Count + num4);
					StringVariableParser.rumourTeam = base.GetEntity(i);
					Game.instance.dialogSystem.SendMail(new DialogCriteria[]
					{
						new DialogCriteria("Who", "MediaPerson"),
						new DialogCriteria("Source", "FinancialTakeover"),
						new DialogCriteria("Type", "Header")
					});
					num5 = i - 1;
				}
				if ((random < 0.05f && num5 == i) || (random < 0.2f && base.GetEntity(i).chairman.happinessNormalized < 0.1f && !base.GetEntity(i).isCreatedByPlayer && num5 == i))
				{
					base.GetEntity(i + teamData.Count + num4).name = base.GetEntity(i).name;
					base.GetEntity(i).name = teamData[random2].GetStringValue("Name");
					base.GetEntity(i).locationID = teamData[random2].GetStringValue("Location ID");
					base.GetEntity(i).colorID = teamData[random2].GetIntValue("Color");
					base.GetEntity(i).nationality = Nationality.GetNationalityByName(teamData[random2].GetStringValue("Location"));
					base.GetEntity(i).teamID = random2;
					base.GetEntity(i).aggression = teamData[random2].GetFloatValue("Aggression");
					base.GetEntity(i).fanBase = teamData[random2].GetFloatValue("Fan Base");
					base.GetEntity(i).votingCharacteristics = this.GetCharacteristics(teamData[random2].GetStringValue("Political Attributes"));
					if (RandomUtility.GetRandom01() < 0.5f)
					{
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(0), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
					}
					if (RandomUtility.GetRandom01() < 0.5f)
					{
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(1), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
					}
					if (RandomUtility.GetRandom01() < 0.5f)
					{
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(2), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
					}
					if (RandomUtility.GetRandom01() < 1f)
					{
						base.GetEntity(i).financeController.finance.currentBudget -= (long)(teamData[random2].GetFloatValue("Budget") * 100000f);
					}
					if (RandomUtility.GetRandom01() < 0.5f)
					{
						base.GetEntity(i).headquarters.ResetHeadquarters();
					}
					if (RandomUtility.GetRandom01() < 0.5f)
					{
						base.GetEntity(i).sponsorController.ClearAllSponsors();
						base.GetEntity(i).sponsorController.ClearAllSponsorOffers();
					}
					if (RandomUtility.GetRandom01() < 0.8f)
					{
						base.GetEntity(i).carManager.AdaptPartsForNewSeason1(0.7f, 1.3f);
					}
					StringVariableParser.promotedTeam = base.GetEntity(i + teamData.Count + num4);
					StringVariableParser.rumourTeam = base.GetEntity(i);
					Game.instance.dialogSystem.SendMail(new DialogCriteria[]
					{
						new DialogCriteria("Who", "MediaPerson"),
						new DialogCriteria("Source", "UnhappyTakeover"),
						new DialogCriteria("Type", "Header")
					});
					num5 = i - 1;
				}
				if (random < 0.1f && !base.GetEntity(i).isCreatedByPlayer && num5 == i)
				{
					base.GetEntity(i + teamData.Count + num4).name = base.GetEntity(i).name;
					base.GetEntity(i).votingCharacteristics = this.GetCharacteristics(teamData[random2].GetStringValue("Political Attributes"));
					base.GetEntity(i).name = teamData[random2].GetStringValue("Name");
					base.GetEntity(i).locationID = teamData[random2].GetStringValue("Location ID");
					base.GetEntity(i).colorID = teamData[random2].GetIntValue("Color");
					base.GetEntity(i).nationality = Nationality.GetNationalityByName(teamData[random2].GetStringValue("Location"));
					base.GetEntity(i).teamID = random2;
					base.GetEntity(i).aggression = teamData[random2].GetFloatValue("Aggression");
					if (RandomUtility.GetRandom01() < 0f)
					{
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(0), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(1), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
						base.GetEntity(i).contractManager.FireDriver(base.GetEntity(i).GetDriver(2), Contract.ContractTerminationType.FiredByPlayer);
						base.GetEntity(i).contractManager.HireReplacementDriver();
					}
					if (RandomUtility.GetRandom01() < 0.75f)
					{
						base.GetEntity(i).financeController.finance.currentBudget += (long)(teamData[random2].GetFloatValue("Budget") * 100000f);
					}
					if (RandomUtility.GetRandom01() < 0f)
					{
						base.GetEntity(i).headquarters.ResetHeadquarters();
					}
					if (RandomUtility.GetRandom01() < 0.1f)
					{
						base.GetEntity(i).sponsorController.ClearAllSponsors();
						base.GetEntity(i).sponsorController.ClearAllSponsorOffers();
					}
					if (RandomUtility.GetRandom01() < 1f)
					{
						base.GetEntity(i).carManager.AdaptPartsForNewSeason1(1f, 1.3f);
					}
					StringVariableParser.promotedTeam = base.GetEntity(i + teamData.Count + num4);
					StringVariableParser.rumourTeam = base.GetEntity(i);
					Game.instance.dialogSystem.SendMail(new DialogCriteria[]
					{
						new DialogCriteria("Who", "MediaPerson"),
						new DialogCriteria("Source", "HappyTakeover"),
						new DialogCriteria("Type", "Header")
					});
					num5 = i - 1;
				}
				float num13 = 0f;
				if (Game.instance.player.team.teamID == base.GetEntity(i).teamID && Game.instance.player.team.championship.championshipID != base.GetEntity(i).championship.championshipID && base.GetEntity(i).championship.championshipID < 999)
				{
					Game.instance.player.SendJobApplication(Game.instance.teamManager.GetEntity(i));
					num13 = 1f;
				}
				if (Game.instance.time.now.Month > 5 && base.GetEntity(i).teamID < 999 && ((float)i == num || (float)i == num2 || (float)i == num3) && num13 == 0f)
				{
					Game.instance.player.SendJobApplication(Game.instance.teamManager.GetEntity(i));
				}
				base.GetEntity(teamData.Count + num4 - 1).name = teamData[base.GetEntity(teamData.Count + num4).teamID].GetStringValue("Name");
			}
		}
	}
}
